<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«æŸ´äººæ¸¸æˆ - ç‹¬ç«‹æµ‹è¯•ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #debug {
            background: rgba(0,0,0,0.8);
            color: #0f0;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
        }
        #gameArea {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px;
        }
        canvas {
            border: 3px solid rgba(255,255,255,0.5);
            border-radius: 8px;
            background: linear-gradient(180deg, #87CEEB 0%, #B0E0E6 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .controls {
            margin-top: 10px;
            text-align: center;
            color: white;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div id="debug">åˆå§‹åŒ–ä¸­...</div>

    <div id="gameArea">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
    </div>

    <div class="controls">
        <div>ç©å®¶1: WASDç§»åŠ¨, Få‡ºæ‹³, Gè¸¢è…¿ | ç©å®¶2: æ–¹å‘é”®ç§»åŠ¨, Jå‡ºæ‹³, Kè¸¢è…¿</div>
        <button onclick="resetGame()">ğŸ”„ é‡ç½®æ¸¸æˆ</button>
        <button onclick="togglePause()">â¸ï¸ æš‚åœ</button>
        <button onclick="testFullscreen()">ğŸ–¥ï¸ æµ‹è¯•å…¨å±</button>
    </div>

    <script>
        const debug = document.getElementById('debug');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let gameState = {
            paused: false,
            gameOver: false,
            player1: null,
            player2: null,
            weapons: []
        };

        const keys = {};

        function log(msg) {
            debug.innerHTML += `<div>${msg}</div>`;
            debug.scrollTop = debug.scrollHeight;
            console.log(msg);
        }

        // ç®€åŒ–ç‰ˆç©å®¶ç±»
        class SimplePlayer {
            constructor(x, y, color, controls, num) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.controls = controls;
                this.num = num;
                this.vx = 0;
                this.vy = 0;
                this.width = 30;
                this.height = 60;
                this.health = 100;
                this.onGround = false;
                log(`âœ… ç©å®¶${num} åˆå§‹åŒ–å®Œæˆ`);
            }

            update() {
                if (gameState.paused || gameState.gameOver) return;

                this.vx = 0;
                if (keys[this.controls.left]) this.vx = -4;
                if (keys[this.controls.right]) this.vx = 4;
                if (keys[this.controls.jump] && this.onGround) {
                    this.vy = -12;
                    this.onGround = false;
                }

                this.vy += 0.6; // é‡åŠ›
                this.x += this.vx;
                this.y += this.vy;

                // åœ°é¢ç¢°æ’
                const ground = canvas.height - 80;
                if (this.y + this.height >= ground) {
                    this.y = ground - this.height;
                    this.vy = 0;
                    this.onGround = true;
                }

                // è¾¹ç•Œ
                if (this.x < 0) this.x = 0;
                if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
            }

            draw() {
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';

                const cx = this.x + this.width / 2;
                const cy = this.y + 15;

                // å¤´
                ctx.beginPath();
                ctx.arc(cx, this.y + 8, 8, 0, Math.PI * 2);
                ctx.stroke();

                // èº«ä½“
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx, cy + 25);
                ctx.stroke();

                // è…¿
                ctx.beginPath();
                ctx.moveTo(cx, cy + 25);
                ctx.lineTo(cx - 6, cy + 45);
                ctx.moveTo(cx, cy + 25);
                ctx.lineTo(cx + 6, cy + 45);
                ctx.stroke();

                // æ‰‹è‡‚
                ctx.beginPath();
                ctx.moveTo(cx, cy + 8);
                ctx.lineTo(cx + 12, cy + 8);
                ctx.moveTo(cx, cy + 8);
                ctx.lineTo(cx - 8, cy + 10);
                ctx.stroke();
            }
        }

        function drawBackground() {
            // å¤©ç©º
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#B0E0E6');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // å¤ªé˜³
            ctx.beginPath();
            ctx.arc(550, 60, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2;
            ctx.stroke();

            // äº‘æœµ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            drawCloud(100, 70);
            drawCloud(350, 50);
            drawCloud(480, 80);

            // åœ°é¢
            const groundY = canvas.height - 80;
            ctx.fillStyle = '#654321';
            ctx.fillRect(0, groundY, canvas.width, 80);

            // åœ°é¢çº¹ç†
            ctx.strokeStyle = '#4a3319';
            ctx.lineWidth = 1.5;
            for (let i = 0; i < canvas.width; i += 12) {
                ctx.beginPath();
                ctx.moveTo(i, groundY);
                ctx.lineTo(i, groundY + 10);
                ctx.stroke();
            }
        }

        function drawCloud(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.arc(x + 12, y - 5, 18, 0, Math.PI * 2);
            ctx.arc(x + 24, y, 15, 0, Math.PI * 2);
            ctx.fill();
        }

        function gameLoop() {
            // ç¡®ä¿canvaså’Œcontextå­˜åœ¨
            if (!canvas || !ctx) {
                console.log('âŒ Canvasæˆ–Contextæœªå‡†å¤‡å¥½');
                return;
            }

            // æ€»æ˜¯ç»˜åˆ¶èƒŒæ™¯
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();

            // æ£€æŸ¥ç©å®¶æ˜¯å¦å­˜åœ¨
            if (!gameState.player1 || !gameState.player2) {
                requestAnimationFrame(gameLoop);
                return;
            }

            // ç»˜åˆ¶ç©å®¶ï¼ˆå³ä½¿åœ¨æš‚åœæˆ–æ¸¸æˆç»“æŸçŠ¶æ€ï¼‰
            gameState.player1.draw();
            gameState.player2.draw();

            // å¦‚æœæ¸¸æˆæš‚åœæˆ–ç»“æŸï¼Œåªæ˜¾ç¤ºçŠ¶æ€ï¼Œä¸æ›´æ–°é€»è¾‘
            if (gameState.paused || gameState.gameOver) {
                updateStatusDisplay();
                requestAnimationFrame(gameLoop);
                return;
            }

            // æ¸¸æˆè¿›è¡Œä¸­ï¼šæ›´æ–°é€»è¾‘
            gameState.player1.update();
            gameState.player2.update();

            // ç®€å•çš„ç¢°æ’æ£€æµ‹
            const dist = Math.abs(gameState.player1.x - gameState.player2.x);
            if (dist < 50) {
                // ç®€å•çš„æ”»å‡»é€»è¾‘
                if (keys['f']) {
                    gameState.player2.health -= 1;
                    log(`ğŸ’¥ ç©å®¶1æ”»å‡»ç©å®¶2 - å‰©ä½™è¡€é‡: ${gameState.player2.health}`);
                }
                if (keys['j']) {
                    gameState.player1.health -= 1;
                    log(`ğŸ’¥ ç©å®¶2æ”»å‡»ç©å®¶1 - å‰©ä½™è¡€é‡: ${gameState.player1.health}`);
                }
            }

            // æ£€æŸ¥æ¸¸æˆç»“æŸ
            if (gameState.player1.health <= 0) {
                gameState.gameOver = true;
                log('ğŸ® æ¸¸æˆç»“æŸ - ç©å®¶2è·èƒœï¼');
            }
            if (gameState.player2.health <= 0) {
                gameState.gameOver = true;
                log('ğŸ® æ¸¸æˆç»“æŸ - ç©å®¶1è·èƒœï¼');
            }

            updateStatusDisplay();
            requestAnimationFrame(gameLoop);
        }

        function updateStatusDisplay() {
            if (!gameState.player1 || !gameState.player2) return;

            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.fillText(`P1: ${gameState.player1.health} HP`, 10, 20);
            ctx.fillText(`P2: ${gameState.player2.health} HP`, canvas.width - 100, 20);

            if (gameState.paused) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '30px Arial';
                ctx.fillText('å·²æš‚åœ', canvas.width/2 - 50, canvas.height/2);
            }

            if (gameState.gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '30px Arial';
                ctx.fillText('æ¸¸æˆç»“æŸï¼', canvas.width/2 - 80, canvas.height/2);
                ctx.font = '16px Arial';
                ctx.fillText('ç‚¹å‡»"é‡ç½®æ¸¸æˆ"é‡æ–°å¼€å§‹', canvas.width/2 - 120, canvas.height/2 + 40);
            }
        }

        function resetGame() {
            gameState.player1 = new SimplePlayer(100, 200, '#ff6b6b', {
                left: 'a', right: 'd', jump: 'w'
            }, 1);

            gameState.player2 = new SimplePlayer(450, 200, '#4dabf7', {
                left: 'ArrowLeft', right: 'ArrowRight', jump: 'ArrowUp'
            }, 2);

            gameState.gameOver = false;
            gameState.paused = false;
            log('ğŸ”„ æ¸¸æˆé‡ç½®å®Œæˆ');
        }

        function togglePause() {
            gameState.paused = !gameState.paused;
            log(gameState.paused ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ ç»§ç»­');
        }

        function testFullscreen() {
            try {
                const elem = document.documentElement;
                if (!document.fullscreenElement) {
                    elem.requestFullscreen();
                    log('ğŸ–¥ï¸ å°è¯•è¿›å…¥å…¨å±');
                } else {
                    document.exitFullscreen();
                    log('ğŸ–¥ï¸ é€€å‡ºå…¨å±');
                }
            } catch(e) {
                log('âŒ å…¨å±å¤±è´¥: ' + e.message);
            }
        }

        // é”®ç›˜äº‹ä»¶
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            keys[e.key.toLowerCase()] = true;
            if (e.key === 'Escape') togglePause();
            if (e.key === 'r' || e.key === 'R') resetGame();
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
            keys[e.key.toLowerCase()] = false;
        });

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('ğŸ® ç‹¬ç«‹æµ‹è¯•ç‰ˆåˆå§‹åŒ–...');

            // ç¡®ä¿canvaså’Œcontextå­˜åœ¨
            const canvas = document.getElementById('gameCanvas');
            if (!canvas) {
                log('âŒ é”™è¯¯: Canvaså…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            const ctx = canvas.getContext('2d');
            if (!ctx) {
                log('âŒ é”™è¯¯: Canvas 2Dä¸Šä¸‹æ–‡ä¸æ”¯æŒ');
                return;
            }

            log('âœ… Canvasæ”¯æŒ: æ˜¯');
            log('âœ… Canvaså°ºå¯¸: ' + canvas.width + 'x' + canvas.height);

            // å…ˆé‡ç½®æ¸¸æˆï¼Œå†å¼€å§‹å¾ªç¯
            resetGame();
            gameLoop();

            log('ğŸ‰ æµ‹è¯•æ¸¸æˆå·²å¯åŠ¨ï¼');
            log('ğŸ’¡ æŒ‰ WASD æ§åˆ¶ç©å®¶1ï¼Œæ–¹å‘é”®æ§åˆ¶ç©å®¶2');
            log('ğŸ’¡ æŒ‰ F/J æ”»å‡»ï¼ŒæŒ‰ R é‡ç½®');
        });
    </script>
</body>
</html>